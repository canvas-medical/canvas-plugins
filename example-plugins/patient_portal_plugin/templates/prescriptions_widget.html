<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Prescriptions Manager</title>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      max-height: 300px;
      font-size: 16px;
      box-sizing: border-box;
      font-family: system-ui, sans-serif;
      display: flex;
    }

    .prescriptions-widget {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      height: calc(100% - 2px);
      max-height: calc(100% - 2px);
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      flex: 1;
    }

    .prescriptions-title {
      color: {{ title_color }};
      font-size: 1.25rem;
      font-weight: 500;
      font-weight: 500;
      padding: 20px 0 8px 20px;
      border-bottom: 1px solid #f3f4f6;
      position: sticky;
      top: 0;
    }

    .prescriptions-list {
      display: flex;
      flex-direction: column;
      justify-content: space-evenly;
      width: 100%;
      flex: 1;
    }

    .prescription-row {
      display: flex;
      padding: 0 1.5rem;
      align-items: center;
    }

    .prescription-icon {
      width: 4rem;
      height: 4rem;
      min-width: 4rem;
      min-height: 4rem;
      border-radius: 50%;
      background: #7dd6c0;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      margin-left: 0.5rem;
      margin-top: 0.125rem;
    }

    .prescription-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: #f7f7f7;
      flex: 1;
      padding: 1.5rem 1rem;
    }

    .prescription-title {
      font-weight: 700;
      font-size: 1.08rem;
      color: #222;
      margin-bottom: 2px;
    }

    .prescription-title a {
      color: #222;
      text-decoration: none;
    }

    .prescription-desc {
      font-size: 0.97rem;
      color: #444;
      font-weight: 400;
    }

    @media (max-width: 600px) {
      .prescriptions-widget {
        padding: 10px 4px 0 4px;
      }

      .prescriptions-title {
        font-size: 1.1rem;
      }

      .prescription-row {
        padding: 8px 0 8px 0;
      }

      .prescription-icon {
        width: 32px;
        height: 32px;
        min-width: 32px;
        min-height: 32px;
        margin-right: 10px;
        margin-left: 2px;
      }
    }
  </style>
</head>

<body>
  <div class="prescriptions-widget">
    <div class="prescriptions-title">Your Prescriptions</div>
    <div class="prescriptions-list">
      <div class="prescription-row">
        <div class="prescription-icon">
          <!-- Plus/Pharmacy SVG Icon -->
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="12" fill="#7dd6c0" />
            <path d="M12 7v10M7 12h10" stroke="#fff" stroke-width="2" stroke-linecap="round" />
          </svg>
        </div>
        <div class="prescription-content">
          <div class="prescription-title">
          {% if not preferred_pharmacy %}
            Choose a preferred pharmacy
          {% else %}
            Update your preferred pharmacy
          {% endif %}
          </div>
          <div class="prescription-desc">
          {% if not preferred_pharmacy %}
            Your prescription will be sent here by default.
          {% else %}
            {{ preferred_pharmacy.pharmacy_name }} @ {{ preferred_pharmacy.pharmacy_address }}
          {% endif %}
          </div>
        </div>
      </div>
      <div class="prescription-row">
        <div class="prescription-icon">
          <!-- Medication/Refill SVG Icon -->
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="12" fill="#7dd6c0" />
            <g>
              <rect x="8" y="8" width="8" height="8" rx="2" fill="#fff" />
              <rect x="10.5" y="10.5" width="3" height="1" rx="0.5" fill="#7dd6c0" />
              <rect x="10.5" y="12.5" width="3" height="1" rx="0.5" fill="#7dd6c0" />
            </g>
          </svg>
        </div>
        <div class="prescription-content">
          <div class="prescription-title">
            <a id="request-refill" href="#">Request a refill</a>
          </div>
          <div class="prescription-desc">
            Send a message requesting a refill be sent to your pharmacy
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const requestRefillLink = document.getElementById('request-refill');
      
      requestRefillLink.addEventListener('click', function (event) {
        event.preventDefault();

        requestRefillLink.classList.add('loading');

        fetch(`{{ api_url }}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          },
        }).then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
        }).finally(() => {
          requestRefillLink.classList.remove('loading');
        });
      });
    });
  </script>
</body>

</html>